Erlang opaque types generator
=====

This application provide parse transform for easy generate opaque **Model** from module it defined, with special functions.

Model description
=====

Usage
----

First of all you need to enable parse_transform in module.

```Erlang
-module(my_model).
-compile({parse_transform, tq_record_transform}).
...
```

Next you need to describe fields

Fields
----
```Erlang
-field({FiledName, [{OptionName, OptionValue}]}).
...
```
Field name must be valid atom.

Options:
  - **type** 
  - **type_constructor** :: Fun | {Mod, Fun} | {Mod, Fun, Args} | none
  - **mode** :: r | w | rw | sr | sw | srsw | rsw | srw
  - **required** : true | false
  - **default** : any()
  - **get** : true | false | custom
  - **set** : true | false | custom
  - **record** : true | false
  - **validators** : Fun | {Mod, Fun} | {Mod, Fun, Args}

Model
----
```Erlang
-model([{OptionName, OptionValue}]).
...

```

Options:
  - **init**: Fun | {Mod, Fun} | {Mod, Fun, Args}
  - **validators** : Fun | {Mod, Fun} | {Mod, Fun, Args}

Autogenerated functions
=====

new/0
----
Create new model
```Erlang 
-spec new() -> Model.
new() -> Model.
```

Getters And Setters
----

```Erlang

%% Getter
-spec FiledName(Model) -> any().
FiledName(Model) -> ... .

%% Setter
-spec set_FiledName(Value :: any(), Model) -> Model.
set_FiledName(Value, Model) -> ... .

```

to_proplist/[1,2]
----

Function convert model to proplist. Only fields which access_mode marked ```r``` are stores in proplist.

```Erlang
-spec to_proplist(Opts, Model) -> [{atom(), any()}, ...] when
  Opts :: [Option],
  Option :: unsafe.

to_proplist(Model) -> 
  ... .
to_proplist(Opts, model) -> 
  ... .
  
```
**Opts** : 
  - **unsafe** - put variables which access_mode marked as ```sr``` in result proplist too
  
from_proplist/[1,2,3]
----
Generates model from proplist with atom keys.

```Erlang
-spec from_proplist(Proplist, Opts, Model) -> {ok, [{atom(), any()}, ...]} | {error, Reasons} when
  Proplist :: [{atom(), any(), ...}],
  Opts :: [Option],
  Option :: unsafe | ignore_unknown,
  Reasons :: [{field(), Reason}],
  Reason :: unknown.

from_proplist(Proplist) -> 
  ... .
from_proplist(Proplist, Opts) -> 
  ... .
from_proplist(Proplist, Model) -> 
  ... .
from_proplist(Proplist, Opts, Model) -> 
  ... .
```

from_bin_proplist/[1,2,3]
---

[ToDo] Description

constructor/1
----

[ToDo] Description

valid/1
----

[ToDo] Description

get_changed_fields/1
---

[ToDo] Description

is_new/1
---

[ToDo] Description

is_changed/2
---

[ToDo] Description

Example
=======

user.erl

```Erlang
-module(user_model).
-compile({parse_transform, tq_record_transform}).

-field({name, 
  [required,
   {type, binary},
   {mode, rw}
  ]}).
  
-field({age, 
  [required,
   {type, integer},
   {mode, rw},
   {validators, [{more_than, [18]}]}
  ]}).
  
-field({password, 
  [{type, binary},
   {mode, srw}
  ]}).
  
more_than(A, Val) when A > Val -> 
  {error, {less_than, A}}.
more_than(A, _Val) ->
  ok.

```

Usage:
```Erlang
1> Data = [{<<"name">>, <<"User1">>}, {<<"password">>, <<"123456">>}, {<<"unknown_data">>, <<"qwerty">>}].
2> {ok, User} = user_model:from_bin_proplist(Data, [ignore_unknown]).
3> User:valid().
{error, [{age, required}]}
4> User2 = User:set_age(12).
5> User2:valid().
{error, [{age, {less_than, 18}}]}
6> User3 = User2:set_age(20).
7> User3:valid().
ok
8> User3:to_proplist().
[{age,20},{name,<<"User1">>}]
9> User3:to_proplist([unsafe]).
[{password,<<"123456">>},{age,20},{name,<<"User1">>}]

```
